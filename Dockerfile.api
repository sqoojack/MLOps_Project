FROM python:3.10-slim

WORKDIR /app

# 複製依賴文件並安裝
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt && \
    pip install --no-cache-dir redis uvicorn

# 複製程式碼與必要模型文件
COPY api/ ./api/
COPY src/ ./src/
COPY params.yaml .
COPY init_redis.py .
# model.pth 與 item_map.json 會由 docker-compose 的 volumes 掛載

EXPOSE 8000

CMD ["uvicorn", "api.main:app", "--host", "0.0.0.0", "--port", "8000"]